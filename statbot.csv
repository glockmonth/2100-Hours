<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2100 Hours Leaderboard | PSRP</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #0a0a0a;
    color: #fff;
    margin: 0;
    padding: 0;
}
.container {
    max-width: 1000px;
    margin: auto;
    padding: 20px;
}
h1 {
    text-align: center;
}
.stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
}
.stat {
    background-color: #1a1a1a;
    padding: 10px 20px;
    border-radius: 8px;
    text-align: center;
}
.stat h2 { margin: 0; font-size: 24px; }
.stat p { margin: 0; font-size: 14px; color: #aaa; }
table {
    width: 100%;
    border-collapse: collapse;
    background-color: #1a1a1a;
}
th, td {
    padding: 10px;
    border-bottom: 1px solid #333;
}
th {
    background-color: #111;
}
td.hours {
    text-align: right;
}
td.rank {
    text-align: center;
}
</style>
</head>
<body>
<div class="container">
    <h1>2100 Hours Leaderboard</h1>
    <div class="stats">
        <div class="stat">
            <h2 id="total-members">0</h2>
            <p>Total Members</p>
        </div>
        <div class="stat">
            <h2 id="total-hours">0</h2>
            <p>Total Hours</p>
        </div>
        <div class="stat">
            <h2 id="avg-hours">NaN</h2>
            <p>Average Hours</p>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th class="rank">Rank</th>
                <th>Member Name</th>
                <th>Rank</th>
                <th>Hours This Week</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="leaderboard-body">
            <!-- Data injected here -->
        </tbody>
    </table>
</div>

<script>
const CSV_URL = './statbot.csv'; // replace with your CSV file path

async function loadCSV() {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const rows = text.split('\n');

    // Skip header lines (first 4 lines)
    const dataRows = rows.slice(4);

    const members = dataRows.map(row => {
        if (!row.trim()) return null;
        // Split CSV but keep quoted commas inside quotes
        const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
        if (!cols || cols.length < 4) return null;

        const username = cols[1].replace(/^"|"$/g, '').trim();
        let hours = parseFloat(cols[3]);
        if (isNaN(hours)) hours = 0;

        return { username, hours };
    }).filter(Boolean);

    return members;
}

function renderLeaderboard(members) {
    // Sort descending by hours
    members.sort((a,b) => b.hours - a.hours);

    // Stats
    document.getElementById('total-members').textContent = members.length;
    const totalHours = members.reduce((sum, m) => sum + m.hours, 0);
    document.getElementById('total-hours').textContent = totalHours.toFixed(2);
    document.getElementById('avg-hours').textContent = 'NaN'; // keep NaN for now

    // Render full leaderboard
    const tbody = document.getElementById('leaderboard-body');
    tbody.innerHTML = '';
    members.forEach((m,i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="rank">${i+1}</td>
            <td>${m.username}</td>
            <td>Member</td>
            <td class="hours">${m.hours.toFixed(2)}</td>
            <td style="color:#00ff00;">‚óè Active</td>
        `;
        tbody.appendChild(tr);
    });
}

async function init() {
    const members = await loadCSV();
    renderLeaderboard(members);
}

init();
</script>
</body>
</html>
